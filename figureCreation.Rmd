---
title: "Report Out Figures"
output: html_document
date: ""
---

```{r, message = FALSE, echo = FALSE,results='hide', warning=FALSE}
library(here)
library(patchwork)
library(ggpubr)
library(tibble)

# Inherit plots
knitr::knit_child(here("anvilPoll2024MainAnalysis.Rmd"))
```

## Figure 1: Flowchart

![Design of the Poll](plots/AnVILPoll2024Flowchart_returninglabel.png)

## Figure 2: Type of User Identification and Background

```{r, fig.width = 10, fig.height = 14}

(typeOfUserPlot + xlim(c(0,45)) + ggtitle(""))  /
  (degreePlot + xlim(c(0,45)) + ggtitle("")) /
  (instTypePlot + xlim(c(0,45)) + ggtitle("")) +
  plot_layout(guides = 'collect',
              axis_title="collect") +
  plot_annotation(title = "Type of User Identification and Background",
                  caption = "A: How would you describe your current usage of the AnVIL platform?\nB: What is the highest degree you have attained?\nC: What institution are you affiliated with?",
                  tag_levels = 'A',
                  theme = theme(plot.title = element_text(size = 16),
                                plot.caption.position = "plot",
                                plot.caption = element_text(hjust = 0)
                                )
                  )

ggsave(here("plots/user_identification_panels.png"), width=10, height=14, units = "in")
```

## Figure 3: User research experience  

```{r, fig.width=6, fig.height = 5}
genomicsExpPlot_replot + 
  plot_annotation(title = "User research experience",
                  caption = "How much experience do you have analyzing the following data categories?", 
                  theme = theme(plot.title = element_text(size = 16),
                                plot.caption.position = "plot",
                                plot.caption = element_text(hjust = 0)
                                )
                  )
ggsave(here("plots/user_research_experience_panels.png"), width=6, height=5, units = "in")

```

## Figure 4: User Preferences

```{r, fig.width = 8, fig.height = 10}
(gdumbbell + ggtitle("")) /
  plot_spacer() /
  (tdumbbell + ggtitle("")) +
  plot_annotation(title = "User Preferences",
                  caption = "A: Rank the following features according to their importance to you as a potential user or for your continued use of the AnVIL.\nB: Rank how/where you would prefer to attend AnVIL training workshops.",
                  tag_levels = "A",
                  theme = theme(plot.title = element_text(size = 16),
                                plot.caption.position = "plot",
                                plot.caption = element_text(hjust = 0)
                                )
                  ) +
  plot_layout(guides = "collect",
              axis_title = "collect",
              widths = c(8), heights = c(5, 0.25, 3)) & theme(legend.position = 'bottom')

ggsave(here("plots/user_preferences_panels.png"), width=8, height=10, units="in")
```

## Figure 5: User Technological Comfort

```{r, fig.width = 8, fig.height = 10}
(PlotToolKnowledge_avg_score + ggtitle("") + ylab("")) /
  (whereRunPlot + ggtitle("") + ylab("")) + 
  plot_annotation(title = "User Technological Comfort",
                  caption = "A: How would you rate your knowledge of or comfort with these technologies or data features?\nB: Where do you currently run analyses?",
                  tag_levels = "A",
                  theme = theme(plot.title = element_text(size = 16),
                                plot.caption.position = "plot",
                                plot.caption = element_text(hjust = 0)
                                )
                  )

ggsave(here("plots/user_tech_comfort_panels.png"), width=8, height=10, units="in")
```

## Figure 6: Support Awareness

```{r, fig.width = 10, fig.height = 8}
((demoPlotRaw + ggtitle("") + xlab("")) + (demoPlot + ggtitle("") + ylab("") + xlab(""))) /
  ((forumPlotRaw + ggtitle("")) + (forumPlot + ggtitle("") + ylab(""))) +
  plot_annotation(title = "User awareness and utilization of AnVIL support",
                  caption = "A & B: Have you attended a monthly AnVIL Demo? A shows raw responses while B recodes those responses to report on whether the user is or isn't aware of AnVIL Demos.\nC & D: Have you ever read or posted in our AnVIL Support Forum? C shows raw responses (users could select more than one), while D recodes each user's set of responses to report on whether the user is or isn't aware of the AnVIL Support Forum.",
                  tag_levels = "A",
                  theme = theme(plot.title = element_text(size = 16),
                                plot.caption.position = "plot",
                                plot.caption = element_text(hjust=0)
                                )
                  ) +
  plot_layout(guides = "collect") & theme(legend.position = "bottom")

ggsave(here("plots/awareness_panels.png"), width=10, height=8, units="in")
```

## Figure 7: Personas

Want to add some kind of clustering or colored lines or shape or something to show which persona/group each respondent/column is

```{r, fig.wdith = 8, fig.height = 8}
load(here("data/persona_classifications.rdata"))

kowpersona <- full_join(
  rbind(
     clinician_persona,
     analyst_persona,
     educator_persona,
     pi_persona,
     admin_persona,
     no_persona
  ) %>% 
    ungroup() %>% 
    select(persona, Timestamp) %>%
    mutate(Timestamp = factor(Timestamp),
           persona = na_if(persona, "None Assigned")),
  dfForPlotKOW, by = "Timestamp")

p1 <- ggplot(kowpersona,
       aes(x = Timestamp,
           y = factor(KindOfWork, levels = factorLevel),
           fill = KindOfWork
           )) +
  geom_tile() +
  theme_bw() +
  theme(axis.text.x=element_blank(),
        axis.ticks.x=element_blank(),
        legend.position = "None") +
  ylab("") +
  ggtitle("What kind of work do you do?") +
  xlab("") +
  #xlab("Respondent") +
  facet_wrap(~UserType, scales = "free_x")

p2 <-ggplot(kowpersona,
       aes(x = Timestamp,
           y = -1,
           fill = persona)) +
  geom_col(width = 1) +
  theme_bw() +
  theme(axis.text.x = element_blank(),
        axis.ticks.x=element_blank(),
        axis.text.y = element_blank(),
        axis.ticks.y=element_blank(), 
        strip.text = element_blank(),
        legend.position = "bottom") +
  ylab("") +
  xlab("Respondent") +
  facet_wrap(~UserType,scales = "free_x") +
  ylim(c(0,-1)) +
  scale_fill_grey(start = 0.8, end = 0, na.value = "white")

p3 <- kowpersona %>% 
  select(persona, Timestamp) %>%
  distinct() %>%
  ggplot(aes(x = factor(1), 
           fill=persona)) +
  geom_bar(stat="count", width=1) +
  coord_polar("y", start=0) +
  scale_fill_grey(start = 0.8, end = 0, na.value = "white") +
  theme_void() +
  geom_text(stat='count',
            aes(label = after_stat(..count..)),
            position = position_stack(vjust = 0.5)) +
  theme(legend.position = "none")

p1 / p2 / p3 +
  plot_layout(widths = c(8), heights = c(4, 0.25, 3.5))
  
ggsave(here("plots/personas_panels.png"), width=8, height=8, units="in")
```
